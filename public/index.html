<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="PA25 Sascha — Basic HTML starter" />
    <title>PA25 Sascha</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles/styles.css">

    <!-- jQuery einbinden -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <h1>&#127828;Burgermeisterin&#127828;</h1>
    </header>   
    <main class="row">
        <div class="col-7" id="burger">
            <h4>Dein Burger:</h4>
                
                <div id="burger-display" class="burger-display dropZone">
                <p class="text-sm" id="empty">Wähle zuerst deine Zutaten aus!</p>
                </div>
            <button id="reset-btn" class="btn">Zurücksetzen</button>

            <h5>Umweltbelastung deines Burgers</h5>
            <table class="table">
                <thead></thead>
                <tr>
                    <th>Kategorie</th>
                    <th>Wasserverbrauch</th>
                    <th>CO2-Verbrauch</th>
                </tr>
                </thead>
                <tbody id="ingredient-table">

                </tbody>
                <tfoot>
                    <tr class="category-head">
                        <td>Total</td>
                        <td id="water-usage">0 l</td>
                        <td id="co2-emissions">0 kg</td>
                    </tr>
                </tfoot>
                
              
            </table>
        </div>
        <div class="col-5">
            <h3>Zutaten auswählen:</h3>
            <div id="ingredients-list" class="row">
                <!-- Dynamische Zutatenliste -->
                
            </div>
        </div>
    </main>
    <footer>
        <p class="text-xs">&copy; <span id="year"></span> PA25 Sascha, Daten der Items: <a href="https://foodprint.org/" class="link">Foodprint</a></p>
    </footer>

    <script src="functions.js"></script>

    <script>
        
        // aktuelles Jahr für Footer
        document.getElementById('year').textContent = new Date().getFullYear();

        // Standard Zutaten laden (WIP)
        const defaultIngredients = loadIngredients();

        console.log('Lade Zutaten...');
       
        // Zutaten laden und anzeigen
        fetch('ingredients.json')
            .then(response => response.json())
            .then(data => {
                const ingredientsList = document.getElementById('ingredients-list');
                const currentTotalCO2 = 0;
                const currentTotalWater = 0;

                // Kategorien durchlaufen
                for (const category in data) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'ingredient-category col-6';
                    categoryDiv.setAttribute('id', category + "_category");
                    const categoryTitle = document.createElement('h5');
                    const categoryItems = document.createElement('div');
                    categoryItems.className = category + "_category";
                    categoryTitle.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                    categoryDiv.appendChild(categoryTitle);

                    const categoryContent = Array();

                    // Zutaten der Kategorie durchlaufen
                    data[category].forEach(ingredient => {
                        const ingredientPanel = createIngredientItems(ingredient);
                        categoryDiv.appendChild(ingredientPanel);
                        const item = Array(ingredient.name, ingredient.co2, ingredient.water, ingredient.icon, ingredient.category);    
                        categoryContent.push(item);            
                    });

                    ingredientsList.appendChild(categoryDiv);
                }

                // Drag-and-Drop Funktionalität initiliaiseren, sobald die Items aus JSON geladen sind
                // https://dev.to/lensco825/making-a-simple-drag-and-drop-with-js-29l2 --> Vorlage
                const dragItems = document.querySelectorAll('.dragElement');
                const dropZone = document.querySelector('.dropZone');

                if (dropZone) {
                    dropZone.addEventListener('dragover', (e) => {
                        e.preventDefault();
                    });

                    dropZone.addEventListener('dragenter', () => {
                        dropZone.classList.add('hoverover');
                    });

                    dropZone.addEventListener('dragleave', () => {
                        dropZone.classList.remove('hoverover');
                    });

                    dropZone.addEventListener('drop', (e) => {
                        e.preventDefault();
                        const dragging = document.querySelector('.dragging');
                        if (dragging) {
                            dropZone.appendChild(dragging);
                            dragging.classList.remove('dragging');
                        }
                        $('#ingredient-table').append('<tr><td>' + dragging.textContent + '</td><td>' + dragging.getAttribute('data-water') + ' l</td><td>' + dragging.getAttribute('data-co2') + ' kg</td></tr>');
                        const currentTotalCO2 = parseFloat(document.getElementById('co2-emissions').textContent) || 0;
                        const currentTotalWater = parseFloat(document.getElementById('water-usage').textContent) || 0;
                        const newValues = calculateCO2AndWater(
                            dragging.textContent,
                            parseFloat(dragging.getAttribute('data-co2')) || 0,
                            parseFloat(dragging.getAttribute('data-water')) || 0,
                            currentTotalCO2,
                            currentTotalWater
                        );

                        
                    });
                }

                dragItems.forEach(item => {
                    item.addEventListener('dragstart', function() {
                        this.classList.add('dragging');
                    });

                    item.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                        this.classList.add('inList');
                        
                    });
                    
                });
                
                // Reset-Button
                $('#reset-btn').on('click', function() {
                    // Liste zurück in Zutatenbereich verschieben
                    $('.inList').each(function() {
                        const ingredient = {
                            name : $(this).text().split(' ')[1],
                            icon : $(this).text().split(' ')[0],
                            co2 : $(this).attr('data-co2'),
                            water : $(this).attr('data-water'),
                            category : $(this).attr('category')
                        };
                        const ingredientPanel = createIngredientItems(ingredient);
                        $("#"+$(this).attr('category')+"_category").append(ingredientPanel);
                    });
            
                    
                    $('#burger-display').empty().append('<p class="text-sm" id="empty">Wähle zuerst deine Zutaten aus!</p>');

                    // CO2- und Wasserwerte zurücksetzen
                    $('#co2-emissions').text('0 kg');
                    $('#water-usage').text('0 l');

                    $('#ingredient-table').empty();
                });

            })
            .catch(error => console.error('Error loading ingredients:', error));
            

           
    </script>
</body>
</html>