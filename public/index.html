<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="PA25 Sascha — Basic HTML starter" />
    <title>PA25 Sascha</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles/styles.css">

    <!-- jQuery einbinden -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <h1>&#127828;Burgermeisterin&#127828;</h1>
    </header>   
    <main class="row">
        <div class="col-7" id="burger">
            <h4>Dein Burger:</h4>
                <div id="burger-display" class="burger-display dropZone">
                <p class="text-sm" id="empty">Wähle zuerst deine Zutaten aus!</p>
            </div>
            <button id="reset-btn" class="btn">Zurücksetzen</button>

            <h5>Umweltbelastung deines Burgers</h5>
            <table class="table">
                <tr>
                    <th>Kategorie</th>
                    <th>Wert</th>
                </tr>
                <tr class="category-head">
                    <td>CO2-Emissionen (Total)</td>
                    <td id="co2-emissions">0 kg</td>
                </tr>
                <tr>
                    <td>Rindfleisch-Pattie</td>
                    <td id="co2-pattie">0 kg</td>
                </tr>
                <tr class="category-head">
                    <td>Wasserverbrauch (Total)</td>
                    <td id="water-usage">0 l</td>
                </tr>
                <tr>
                    <td>Rindfleisch-Pattie</td>
                    <td id="co2-pattie">0 kg</td>
                </tr>
            </table>
        </div>
        <div class="col-5">
            <h3>Zutaten auswählen:</h3>
            <div id="ingredients-list" class="row">
                <!-- Dynamische Zutatenliste -->
                
            </div>
        </div>
    </main>
    <footer>
        <p class="text-xs">&copy; <span id="year"></span> PA25 Sascha</p>
    </footer>

    <script>
        // aktuelles Jahr für Footer
        document.getElementById('year').textContent = new Date().getFullYear();

        // Reset-Button
        $('#reset-btn').on('click', function() {
            $('#burger-display').empty().append('<p class="text-sm">Wähle zuerst deine Zutaten aus!</p>');
        }); 

        // Zutaten laden und anzeigen
        fetch('ingredients.json')
            .then(response => response.json())
            .then(data => {
                const ingredientsList = document.getElementById('ingredients-list');

                // Kategorien durchlaufen
                for (const category in data) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'ingredient-category col-6';
                    const categoryTitle = document.createElement('h5');
                    categoryTitle.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                    categoryDiv.appendChild(categoryTitle);

                    data[category].forEach(ingredient => {
                        const ingredientPanel = document.createElement('div');
                        ingredientPanel.className = 'ingredient-panel dragElement ' + category;
                        ingredientPanel.setAttribute('draggable', 'true');
                        ingredientPanel.textContent = (ingredient.icon || '') + ingredient.name;
                        categoryDiv.appendChild(ingredientPanel);             
                    });

                    ingredientsList.appendChild(categoryDiv);
                }

                // Drag-and-Drop Funktionalität initiliaiseren, sobald die Items aus JSON geladen sind
                // https://dev.to/lensco825/making-a-simple-drag-and-drop-with-js-29l2 --> Vorlage
                const dragItems = document.querySelectorAll('.dragElement');
                const dropZone = document.querySelector('.dropZone');

                if (dropZone) {
                    dropZone.addEventListener('dragover', (e) => {
                        e.preventDefault();
                    });

                    dropZone.addEventListener('dragenter', () => {
                        dropZone.classList.add('hoverover');
                    });

                    dropZone.addEventListener('dragleave', () => {
                        dropZone.classList.remove('hoverover');
                    });

                    dropZone.addEventListener('drop', (e) => {
                        e.preventDefault();
                        const dragging = document.querySelector('.dragging');
                        if (dragging) {
                            dropZone.appendChild(dragging);
                            dragging.classList.remove('dragging');
                            $("#empty").setAttribute("style","display:none");
                        }
                    });
                }

                dragItems.forEach(item => {
                    item.addEventListener('dragstart', function() {
                        this.classList.add('dragging');
                    });

                    item.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });
            })
            .catch(error => console.error('Error loading ingredients:', error));

    </script>
</body>
</html>